(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const S of u.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&r(S)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();function sr(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var me,ft;function ee(){if(ft)return me;ft=1;var m=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function r(u){if(u==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(u)}function o(){try{if(!Object.assign)return!1;var u=new String("abc");if(u[5]="de",Object.getOwnPropertyNames(u)[0]==="5")return!1;for(var S={},g=0;g<10;g++)S["_"+String.fromCharCode(g)]=g;var p=Object.getOwnPropertyNames(S).map(function(s){return S[s]});if(p.join("")!=="0123456789")return!1;var v={};return"abcdefghijklmnopqrst".split("").forEach(function(s){v[s]=s}),Object.keys(Object.assign({},v)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return me=o()?Object.assign:function(u,S){for(var g,p=r(u),v,s=1;s<arguments.length;s++){g=Object(arguments[s]);for(var a in g)t.call(g,a)&&(p[a]=g[a]);if(m){v=m(g);for(var l=0;l<v.length;l++)n.call(g,v[l])&&(p[v[l]]=g[v[l]])}}return p},me}var ge={exports:{}},ye,ht;function at(){return ht||(ht=1,ye=function(m,t,n){t.forEach(function(r){var o=n[r];m.prototype[r]=function(u){return u.ros=this,new o(u)}})}),ye}var we,vt;function nr(){return vt||(vt=1,we=typeof window<"u"?window.WebSocket:WebSocket),we}var _e,pt;function gr(){if(pt)return _e;pt=1;var m=arguments[3],t=arguments[4],n=arguments[5],r=JSON.stringify;return _e=function(o,u){for(var S,g=Object.keys(n),p=0,v=g.length;p<v;p++){var s=g[p],a=n[s].exports;if(a===o||a&&a.default===o){S=s;break}}if(!S){S=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var l={},p=0,v=g.length;p<v;p++){var s=g[p];l[s]=s}t[S]=["function(require,module,exports){"+o+"(self); }",l]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),x={};x[S]=S,t[f]=["function(require,module,exports){var f = require("+r(S)+");(f.default ? f.default : f)(self);}",x];var k={};O(f);function O(V){k[V]=!0;for(var J in t[V][1]){var Q=t[V][1][J];k[Q]||O(Q)}}var A="("+m+")({"+Object.keys(k).map(function(V){return r(V)+":["+t[V][0]+","+r(t[V][1])+"]"}).join(",")+"},{},["+r(f)+"])",L=window.URL||window.webkitURL||window.mozURL||window.msURL,M=new Blob([A],{type:"text/javascript"});if(u&&u.bare)return M;var D=L.createObjectURL(M),q=new Worker(D);return q.objectURL=D,q},_e}var be={exports:{}},dt;function yr(){return dt||(dt=1,function(m){function t(v){var s={};function a(f){if(s[f])return s[f].exports;var x=s[f]={i:f,l:!1,exports:{}};return v[f].call(x.exports,x,x.exports,a),x.l=!0,x.exports}a.m=v,a.c=s,a.i=function(f){return f},a.d=function(f,x,k){a.o(f,x)||Object.defineProperty(f,x,{configurable:!1,enumerable:!0,get:k})},a.r=function(f){Object.defineProperty(f,"__esModule",{value:!0})},a.n=function(f){var x=f&&f.__esModule?function(){return f.default}:function(){return f};return a.d(x,"a",x),x},a.o=function(f,x){return Object.prototype.hasOwnProperty.call(f,x)},a.p="/",a.oe=function(f){throw console.error(f),f};var l=a(a.s=ENTRY_MODULE);return l.default||l}var n="[\\.|\\-|\\+|\\w|/|@]+",r="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+n+").*?\\)";function o(v){return(v+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function u(v){return!isNaN(1*v)}function S(v,s,a){var l={};l[a]=[];var f=s.toString(),x=f.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!x)return l;for(var k=x[1],O=new RegExp("(\\\\n|\\W)"+o(k)+r,"g"),A;A=O.exec(f);)A[3]!=="dll-reference"&&l[a].push(A[3]);for(O=new RegExp("\\("+o(k)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+r,"g");A=O.exec(f);)v[A[2]]||(l[a].push(A[1]),v[A[2]]=__webpack_require__(A[1]).m),l[A[2]]=l[A[2]]||[],l[A[2]].push(A[4]);for(var L=Object.keys(l),M=0;M<L.length;M++)for(var D=0;D<l[L[M]].length;D++)u(l[L[M]][D])&&(l[L[M]][D]=1*l[L[M]][D]);return l}function g(v){var s=Object.keys(v);return s.reduce(function(a,l){return a||v[l].length>0},!1)}function p(v,s){for(var a={main:[s]},l={main:[]},f={main:{}};g(a);)for(var x=Object.keys(a),k=0;k<x.length;k++){var O=x[k],A=a[O],L=A.pop();if(f[O]=f[O]||{},!(f[O][L]||!v[O][L])){f[O][L]=!0,l[O]=l[O]||[],l[O].push(L);for(var M=S(v,v[O][L],O),D=Object.keys(M),q=0;q<D.length;q++)a[D[q]]=a[D[q]]||[],a[D[q]]=a[D[q]].concat(M[D[q]])}}return l}m.exports=function(v,s){s=s||{};var a={main:__webpack_modules__},l=s.all?{main:Object.keys(a.main)}:p(a,v),f="";Object.keys(l).filter(function(L){return L!=="main"}).forEach(function(L){for(var M=0;l[L][M];)M++;l[L].push(M),a[L][M]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",f=f+"var "+L+" = ("+t.toString().replace("ENTRY_MODULE",JSON.stringify(M))+")({"+l[L].map(function(D){return""+JSON.stringify(D)+": "+a[L][D].toString()}).join(",")+`});
`}),f=f+"new (("+t.toString().replace("ENTRY_MODULE",JSON.stringify(v))+")({"+l.main.map(function(L){return""+JSON.stringify(L)+": "+a.main[L].toString()}).join(",")+"}))(self);";var x=new window.Blob([f],{type:"text/javascript"});if(s.bare)return x;var k=window.URL||window.webkitURL||window.mozURL||window.msURL,O=k.createObjectURL(x),A=new window.Worker(O);return A.objectURL=O,A}}(be)),be.exports}var Se,mt;function wr(){if(mt)return Se;mt=1;var m=m||nr();return Se=function(t){var n=null;function r(u){var S=u.data;S instanceof ArrayBuffer?t.postMessage(S,[S]):t.postMessage(S)}function o(u){t.postMessage({type:u.type})}t.addEventListener("message",function(u){var S=u.data;if(typeof S=="string")n.send(S);else if(S.hasOwnProperty("close"))n.close(),n=null;else if(S.hasOwnProperty("uri")){var g=S.uri;n=new m(g),n.binaryType="arraybuffer",n.onmessage=r,n.onclose=o,n.onopen=o,n.onerror=o}else throw"Unknown message to WorkerSocket"})},Se}var Te,gt;function _r(){if(gt)return Te;gt=1;try{var m=gr()}catch{var m=yr()}var t=wr();function n(r){this.socket_=m(t),this.socket_.addEventListener("message",this.handleWorkerMessage_.bind(this)),this.socket_.postMessage({uri:r})}return n.prototype.handleWorkerMessage_=function(r){var o=r.data;if(o instanceof ArrayBuffer||typeof o=="string")this.onmessage(r);else{var u=o.type;if(u==="close")this.onclose(null);else if(u==="open")this.onopen(null);else if(u==="error")this.onerror(null);else throw"Unknown message from workersocket"}},n.prototype.send=function(r){this.socket_.postMessage(r)},n.prototype.close=function(){this.socket_.postMessage({close:!0})},Te=n,Te}var xe,yt;function br(){return yt||(yt=1,xe=function(){return document.createElement("canvas")}),xe}var Ee,wt;function Sr(){if(wt)return Ee;wt=1;var m=br(),t=m.Image||window.Image;function n(r,o){var u=new t;u.onload=function(){var S=new m,g=S.getContext("2d");S.width=u.width,S.height=u.height,g.imageSmoothingEnabled=!1,g.webkitImageSmoothingEnabled=!1,g.mozImageSmoothingEnabled=!1,g.drawImage(u,0,0);for(var p=g.getImageData(0,0,u.width,u.height).data,v="",s=0;s<p.length;s+=4)v+=String.fromCharCode(p[s],p[s+1],p[s+2]);o(JSON.parse(v))},u.src="data:image/png;base64,"+r}return Ee=n,Ee}var fe={exports:{}},Tr=fe.exports,_t;function xr(){return _t||(_t=1,function(m){(function(t,n){var r=Math.pow(2,-24),o=Math.pow(2,32),u=Math.pow(2,53);function S(v){var s=new ArrayBuffer(256),a=new DataView(s),l,f=0;function x(R){for(var F=s.byteLength,U=f+R;F<U;)F*=2;if(F!==s.byteLength){var N=a;s=new ArrayBuffer(F),a=new DataView(s);for(var E=f+3>>2,P=0;P<E;++P)a.setUint32(P*4,N.getUint32(P*4))}return l=R,a}function k(){f+=l}function O(R){k(x(8).setFloat64(f,R))}function A(R){k(x(1).setUint8(f,R))}function L(R){for(var F=x(R.length),U=0;U<R.length;++U)F.setUint8(f+U,R[U]);k()}function M(R){k(x(2).setUint16(f,R))}function D(R){k(x(4).setUint32(f,R))}function q(R){var F=R%o,U=(R-F)/o,N=x(8);N.setUint32(f,U),N.setUint32(f+4,F),k()}function V(R,F){F<24?A(R<<5|F):F<256?(A(R<<5|24),A(F)):F<65536?(A(R<<5|25),M(F)):F<4294967296?(A(R<<5|26),D(F)):(A(R<<5|27),q(F))}function J(R){var F;if(R===!1)return A(244);if(R===!0)return A(245);if(R===null)return A(246);if(R===n)return A(247);switch(typeof R){case"number":if(Math.floor(R)===R){if(0<=R&&R<=u)return V(0,R);if(-u<=R&&R<0)return V(1,-(R+1))}return A(251),O(R);case"string":var U=[];for(F=0;F<R.length;++F){var N=R.charCodeAt(F);N<128?U.push(N):N<2048?(U.push(192|N>>6),U.push(128|N&63)):N<55296?(U.push(224|N>>12),U.push(128|N>>6&63),U.push(128|N&63)):(N=(N&1023)<<10,N|=R.charCodeAt(++F)&1023,N+=65536,U.push(240|N>>18),U.push(128|N>>12&63),U.push(128|N>>6&63),U.push(128|N&63))}return V(3,U.length),L(U);default:var E;if(Array.isArray(R))for(E=R.length,V(4,E),F=0;F<E;++F)J(R[F]);else if(R instanceof Uint8Array)V(2,R.length),L(R);else{var P=Object.keys(R);for(E=P.length,V(5,E),F=0;F<E;++F){var I=P[F];J(I),J(R[I])}}}}if(J(v),"slice"in s)return s.slice(0,f);for(var Q=new ArrayBuffer(f),z=new DataView(Q),X=0;X<f;++X)z.setUint8(X,a.getUint8(X));return Q}function g(v,s,a){var l=new DataView(v),f=0;typeof s!="function"&&(s=function(U){return U}),typeof a!="function"&&(a=function(){return n});function x(U,N){return f+=N,U}function k(U){return x(new Uint8Array(v,f,U),U)}function O(){var U=new ArrayBuffer(4),N=new DataView(U),E=D(),P=E&32768,I=E&31744,e=E&1023;if(I===31744)I=261120;else if(I!==0)I+=114688;else if(e!==0)return e*r;return N.setUint32(0,P<<16|I<<13|e<<13),N.getFloat32(0)}function A(){return x(l.getFloat32(f),4)}function L(){return x(l.getFloat64(f),8)}function M(){return x(l.getUint8(f),1)}function D(){return x(l.getUint16(f),2)}function q(){return x(l.getUint32(f),4)}function V(){return q()*o+q()}function J(){return l.getUint8(f)!==255?!1:(f+=1,!0)}function Q(U){if(U<24)return U;if(U===24)return M();if(U===25)return D();if(U===26)return q();if(U===27)return V();if(U===31)return-1;throw"Invalid length encoding"}function z(U){var N=M();if(N===255)return-1;var E=Q(N&31);if(E<0||N>>5!==U)throw"Invalid indefinite length element";return E}function X(U,N){for(var E=0;E<N;++E){var P=M();P&128&&(P<224?(P=(P&31)<<6|M()&63,N-=1):P<240?(P=(P&15)<<12|(M()&63)<<6|M()&63,N-=2):(P=(P&15)<<18|(M()&63)<<12|(M()&63)<<6|M()&63,N-=3)),P<65536?U.push(P):(P-=65536,U.push(55296|P>>10),U.push(56320|P&1023))}}function R(){var U=M(),N=U>>5,E=U&31,P,I;if(N===7)switch(E){case 25:return O();case 26:return A();case 27:return L()}if(I=Q(E),I<0&&(N<2||6<N))throw"Invalid length";switch(N){case 0:return I;case 1:return-1-I;case 2:if(I<0){for(var e=[],i=0;(I=z(N))>=0;)i+=I,e.push(k(I));var c=new Uint8Array(i),h=0;for(P=0;P<e.length;++P)c.set(e[P],h),h+=e[P].length;return c}return k(I);case 3:var d=[];if(I<0)for(;(I=z(N))>=0;)X(d,I);else X(d,I);return String.fromCharCode.apply(null,d);case 4:var y;if(I<0)for(y=[];!J();)y.push(R());else for(y=new Array(I),P=0;P<I;++P)y[P]=R();return y;case 5:var w={};for(P=0;P<I||I<0&&!J();++P){var T=R();w[T]=R()}return w;case 6:return s(R(),I);case 7:switch(I){case 20:return!1;case 21:return!0;case 22:return null;case 23:return n;default:return a(I)}}}var F=R();if(f!==v.byteLength)throw"Remaining bytes";return F}var p={encode:S,decode:g};m.exports?m.exports=p:t.CBOR||(t.CBOR=p)})(Tr)}(fe)),fe.exports}var Ae={exports:{}},bt;function Er(){return bt||(bt=1,function(m){var t=Math.pow(2,32),n=!1;function r(){n||(n=!0,console.warn("CBOR 64-bit integer array values may lose precision. No further warnings."))}function o(s){r();for(var a=s.byteLength,l=s.byteOffset,f=a/8,x=s.buffer.slice(l,l+a),k=new Uint32Array(x),O=new Array(f),A=0;A<f;A++){var L=A*2,M=k[L],D=k[L+1];O[A]=M+t*D}return O}function u(s){r();for(var a=s.byteLength,l=s.byteOffset,f=a/8,x=s.buffer.slice(l,l+a),k=new Uint32Array(x),O=new Int32Array(x),A=new Array(f),L=0;L<f;L++){var M=L*2,D=k[M],q=O[M+1];A[L]=D+t*q}return A}function S(s,a){var l=s.byteLength,f=s.byteOffset,x=s.buffer.slice(f,f+l);return new a(x)}var g={64:Uint8Array,69:Uint16Array,70:Uint32Array,72:Int8Array,77:Int16Array,78:Int32Array,85:Float32Array,86:Float64Array},p={71:o,79:u};function v(s,a){if(a in g){var l=g[a];return S(s,l)}return a in p?p[a](s):s}m.exports&&(m.exports=v)}(Ae)),Ae.exports}var Re,St;function Ar(){if(St)return Re;St=1;var m=Sr(),t=xr(),n=Er(),r=null;typeof bson<"u"&&(r=bson().BSON);function o(u){var S=null;u.transportOptions.decoder&&(S=u.transportOptions.decoder);function g(s){s.op==="publish"?u.emit(s.topic,s.msg):s.op==="service_response"?u.emit(s.id,s):s.op==="call_service"?u.emit(s.service,s):s.op==="status"&&(s.id?u.emit("status:"+s.id,s):u.emit("status",s))}function p(s,a){s.op==="png"?m(s.data,a):a(s)}function v(s,a){if(!r)throw"Cannot process BSON encoded message without BSON header.";var l=new FileReader;l.onload=function(){var f=new Uint8Array(this.result),x=r.deserialize(f);a(x)},l.readAsArrayBuffer(s)}return{onopen:function(a){u.isConnected=!0,u.emit("connection",a)},onclose:function(a){u.isConnected=!1,u.emit("close",a)},onerror:function(a){u.emit("error",a)},onmessage:function(a){if(S)S(a.data,function(x){g(x)});else if(typeof Blob<"u"&&a.data instanceof Blob)v(a.data,function(x){p(x,g)});else if(a.data instanceof ArrayBuffer){var l=t.decode(a.data,n);g(l)}else{var f=JSON.parse(typeof a=="string"?a:a.data);p(f,g)}}}}return Re=o,Re}var Le,Tt;function or(){if(Tt)return Le;Tt=1;var m=ee();function t(n){m(this,n)}return Le=t,Le}var Oe,xt;function ne(){if(xt)return Oe;xt=1;var m=ee();function t(n){m(this,n)}return Oe=t,Oe}var Me={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */var Et;function $(){return Et||(Et=1,function(m,t){(function(n){var r=Object.hasOwnProperty,o=Array.isArray?Array.isArray:function(i){return Object.prototype.toString.call(i)==="[object Array]"},u=10,S=typeof process=="object"&&typeof process.nextTick=="function",g=typeof Symbol=="function",p=typeof Reflect=="object",v=typeof setImmediate=="function",s=v?setImmediate:setTimeout,a=g?p&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(e){var i=Object.getOwnPropertyNames(e);return i.push.apply(i,Object.getOwnPropertySymbols(e)),i}:Object.keys;function l(){this._events={},this._conf&&f.call(this,this._conf)}function f(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==n&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function x(e,i){var c="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(c+=" Event name: "+i+"."),typeof process<"u"&&process.emitWarning){var h=new Error(c);h.name="MaxListenersExceededWarning",h.emitter=this,h.count=e,process.emitWarning(h)}else console.error(c),console.trace&&console.trace()}var k=function(e,i,c){var h=arguments.length;switch(h){case 0:return[];case 1:return[e];case 2:return[e,i];case 3:return[e,i,c];default:for(var d=new Array(h);h--;)d[h]=arguments[h];return d}};function O(e,i){for(var c={},h,d=e.length,y=0,w=0;w<d;w++)h=e[w],c[h]=w<y?i[w]:n;return c}function A(e,i,c){this._emitter=e,this._target=i,this._listeners={},this._listenersCount=0;var h,d;if((c.on||c.off)&&(h=c.on,d=c.off),i.addEventListener?(h=i.addEventListener,d=i.removeEventListener):i.addListener?(h=i.addListener,d=i.removeListener):i.on&&(h=i.on,d=i.off),!h&&!d)throw Error("target does not implement any known event API");if(typeof h!="function")throw TypeError("on method must be a function");if(typeof d!="function")throw TypeError("off method must be a function");this._on=h,this._off=d;var y=e._observers;y?y.push(this):e._observers=[this]}Object.assign(A.prototype,{subscribe:function(e,i,c){var h=this,d=this._target,y=this._emitter,w=this._listeners,T=function(){var _=k.apply(null,arguments),b={data:_,name:i,original:e};if(c){var C=c.call(d,b);C!==!1&&y.emit.apply(y,[b.name].concat(_));return}y.emit.apply(y,[i].concat(_))};if(w[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,y._newListener&&y._removeListener&&!h._onNewListener?(this._onNewListener=function(_){_===i&&w[e]===null&&(w[e]=T,h._on.call(d,e,T))},y.on("newListener",this._onNewListener),this._onRemoveListener=function(_){_===i&&!y.hasListeners(_)&&w[e]&&(w[e]=null,h._off.call(d,e,T))},w[e]=null,y.on("removeListener",this._onRemoveListener)):(w[e]=T,h._on.call(d,e,T))},unsubscribe:function(e){var i=this,c=this._listeners,h=this._emitter,d,y,w=this._off,T=this._target,_;if(e&&typeof e!="string")throw TypeError("event must be a string");function b(){i._onNewListener&&(h.off("newListener",i._onNewListener),h.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var C=Q.call(h,i);h._observers.splice(C,1)}if(e){if(d=c[e],!d)return;w.call(T,e,d),delete c[e],--this._listenersCount||b()}else{for(y=a(c),_=y.length;_-- >0;)e=y[_],w.call(T,e,c[e]);this._listeners={},this._listenersCount=0,b()}}});function L(e,i,c,h){var d=Object.assign({},i);if(!e)return d;if(typeof e!="object")throw TypeError("options must be an object");var y=Object.keys(e),w=y.length,T,_,b;function C(B){throw Error('Invalid "'+T+'" option value'+(B?". Reason: "+B:""))}for(var K=0;K<w;K++){if(T=y[K],!r.call(i,T))throw Error('Unknown "'+T+'" option');_=e[T],_!==n&&(b=c[T],d[T]=b?b(_,C):_)}return d}function M(e,i){return(typeof e!="function"||!e.hasOwnProperty("prototype"))&&i("value must be a constructor"),e}function D(e){var i="value must be type of "+e.join("|"),c=e.length,h=e[0],d=e[1];return c===1?function(y,w){if(typeof y===h)return y;w(i)}:c===2?function(y,w){var T=typeof y;if(T===h||T===d)return y;w(i)}:function(y,w){for(var T=typeof y,_=c;_-- >0;)if(T===e[_])return y;w(i)}}var q=D(["function"]),V=D(["object","function"]);function J(e,i,c){var h,d,y=0,w,T=new e(function(_,b,C){c=L(c,{timeout:0,overload:!1},{timeout:function(W,H){return W*=1,(typeof W!="number"||W<0||!Number.isFinite(W))&&H("timeout must be a positive number"),W}}),h=!c.overload&&typeof e.prototype.cancel=="function"&&typeof C=="function";function K(){d&&(d=null),y&&(clearTimeout(y),y=0)}var B=function(W){K(),_(W)},G=function(W){K(),b(W)};h?i(B,G,C):(d=[function(W){G(W||Error("canceled"))}],i(B,G,function(W){if(w)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof W!="function")throw TypeError("onCancel callback must be a function");d.push(W)}),w=!0),c.timeout>0&&(y=setTimeout(function(){var W=Error("timeout");W.code="ETIMEDOUT",y=0,T.cancel(W),b(W)},c.timeout))});return h||(T.cancel=function(_){if(d){for(var b=d.length,C=1;C<b;C++)d[C](_);d[0](_),d=null}}),T}function Q(e){var i=this._observers;if(!i)return-1;for(var c=i.length,h=0;h<c;h++)if(i[h]._target===e)return h;return-1}function z(e,i,c,h,d){if(!c)return null;if(h===0){var y=typeof i;if(y==="string"){var w,T,_=0,b=0,C=this.delimiter,K=C.length;if((T=i.indexOf(C))!==-1){w=new Array(5);do w[_++]=i.slice(b,T),b=T+K;while((T=i.indexOf(C,b))!==-1);w[_++]=i.slice(b),i=w,d=_}else i=[i],d=1}else y==="object"?d=i.length:(i=[i],d=1)}var B=null,G,W,H,ve,pe,ie=i[h],de=i[h+1],Z,Y;if(h===d)c._listeners&&(typeof c._listeners=="function"?(e&&e.push(c._listeners),B=[c]):(e&&e.push.apply(e,c._listeners),B=[c]));else if(ie==="*"){for(Z=a(c),T=Z.length;T-- >0;)G=Z[T],G!=="_listeners"&&(Y=z(e,i,c[G],h+1,d),Y&&(B?B.push.apply(B,Y):B=Y));return B}else if(ie==="**"){for(pe=h+1===d||h+2===d&&de==="*",pe&&c._listeners&&(B=z(e,i,c,d,d)),Z=a(c),T=Z.length;T-- >0;)G=Z[T],G!=="_listeners"&&(G==="*"||G==="**"?(c[G]._listeners&&!pe&&(Y=z(e,i,c[G],d,d),Y&&(B?B.push.apply(B,Y):B=Y)),Y=z(e,i,c[G],h,d)):G===de?Y=z(e,i,c[G],h+2,d):Y=z(e,i,c[G],h,d),Y&&(B?B.push.apply(B,Y):B=Y));return B}else c[ie]&&(B=z(e,i,c[ie],h+1,d));if(W=c["*"],W&&z(e,i,W,h+1,d),H=c["**"],H)if(h<d)for(H._listeners&&z(e,i,H,d,d),Z=a(H),T=Z.length;T-- >0;)G=Z[T],G!=="_listeners"&&(G===de?z(e,i,H[G],h+2,d):G===ie?z(e,i,H[G],h+1,d):(ve={},ve[G]=H[G],z(e,i,{"**":ve},h+1,d)));else H._listeners?z(e,i,H,d,d):H["*"]&&H["*"]._listeners&&z(e,i,H["*"],d,d);return B}function X(e,i,c){var h=0,d=0,y,w=this.delimiter,T=w.length,_;if(typeof e=="string")if((y=e.indexOf(w))!==-1){_=new Array(5);do _[h++]=e.slice(d,y),d=y+T;while((y=e.indexOf(w,d))!==-1);_[h++]=e.slice(d)}else _=[e],h=1;else _=e,h=e.length;if(h>1){for(y=0;y+1<h;y++)if(_[y]==="**"&&_[y+1]==="**")return}var b=this.listenerTree,C;for(y=0;y<h;y++)if(C=_[y],b=b[C]||(b[C]={}),y===h-1)return b._listeners?(typeof b._listeners=="function"&&(b._listeners=[b._listeners]),c?b._listeners.unshift(i):b._listeners.push(i),!b._listeners.warned&&this._maxListeners>0&&b._listeners.length>this._maxListeners&&(b._listeners.warned=!0,x.call(this,b._listeners.length,C))):b._listeners=i,!0;return!0}function R(e,i,c,h){for(var d=a(e),y=d.length,w,T,_,b=e._listeners,C;y-- >0;)T=d[y],w=e[T],T==="_listeners"?_=c:_=c?c.concat(T):[T],C=h||typeof T=="symbol",b&&i.push(C?_:_.join(this.delimiter)),typeof w=="object"&&R.call(this,w,i,_,C);return i}function F(e){for(var i=a(e),c=i.length,h,d,y;c-- >0;)d=i[c],h=e[d],h&&(y=!0,d!=="_listeners"&&!F(h)&&delete e[d]);return y}function U(e,i,c){this.emitter=e,this.event=i,this.listener=c}U.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function N(e,i,c){if(c===!0)d=!0;else if(c===!1)h=!0;else{if(!c||typeof c!="object")throw TypeError("options should be an object or true");var h=c.async,d=c.promisify,y=c.nextTick,w=c.objectify}if(h||y||d){var T=i,_=i._origin||i;if(y&&!S)throw Error("process.nextTick is not supported");d===n&&(d=i.constructor.name==="AsyncFunction"),i=function(){var b=arguments,C=this,K=this.event;return d?y?Promise.resolve():new Promise(function(B){s(B)}).then(function(){return C.event=K,T.apply(C,b)}):(y?process.nextTick:s)(function(){C.event=K,T.apply(C,b)})},i._async=!0,i._origin=_}return[i,w?new U(this,e,i):this]}function E(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,f.call(this,e)}E.EventEmitter2=E,E.prototype.listenTo=function(e,i,c){if(typeof e!="object")throw TypeError("target musts be an object");var h=this;c=L(c,{on:n,off:n,reducers:n},{on:q,off:q,reducers:V});function d(y){if(typeof y!="object")throw TypeError("events must be an object");var w=c.reducers,T=Q.call(h,e),_;T===-1?_=new A(h,e,c):_=h._observers[T];for(var b=a(y),C=b.length,K,B=typeof w=="function",G=0;G<C;G++)K=b[G],_.subscribe(K,y[K]||K,B?w:w&&w[K])}return o(i)?d(O(i)):d(typeof i=="string"?O(i.split(/\s+/)):i),this},E.prototype.stopListeningTo=function(e,i){var c=this._observers;if(!c)return!1;var h=c.length,d,y=!1;if(e&&typeof e!="object")throw TypeError("target should be an object");for(;h-- >0;)d=c[h],(!e||d._target===e)&&(d.unsubscribe(i),y=!0);return y},E.prototype.delimiter=".",E.prototype.setMaxListeners=function(e){e!==n&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},E.prototype.getMaxListeners=function(){return this._maxListeners},E.prototype.event="",E.prototype.once=function(e,i,c){return this._once(e,i,!1,c)},E.prototype.prependOnceListener=function(e,i,c){return this._once(e,i,!0,c)},E.prototype._once=function(e,i,c,h){return this._many(e,1,i,c,h)},E.prototype.many=function(e,i,c,h){return this._many(e,i,c,!1,h)},E.prototype.prependMany=function(e,i,c,h){return this._many(e,i,c,!0,h)},E.prototype._many=function(e,i,c,h,d){var y=this;if(typeof c!="function")throw new Error("many only accepts instances of Function");function w(){return--i===0&&y.off(e,w),c.apply(this,arguments)}return w._origin=c,this._on(e,w,h,d)},E.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||l.call(this);var e=arguments[0],i,c=this.wildcard,h,d,y,w,T;if(e==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(c&&(i=e,e!=="newListener"&&e!=="removeListener"&&typeof e=="object")){if(d=e.length,g){for(y=0;y<d;y++)if(typeof e[y]=="symbol"){T=!0;break}}T||(e=e.join(this.delimiter))}var _=arguments.length,b;if(this._all&&this._all.length)for(b=this._all.slice(),y=0,d=b.length;y<d;y++)switch(this.event=e,_){case 1:b[y].call(this,e);break;case 2:b[y].call(this,e,arguments[1]);break;case 3:b[y].call(this,e,arguments[1],arguments[2]);break;default:b[y].apply(this,arguments)}if(c)b=[],z.call(this,b,i,this.listenerTree,0,d);else if(b=this._events[e],typeof b=="function"){switch(this.event=e,_){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:for(h=new Array(_-1),w=1;w<_;w++)h[w-1]=arguments[w];b.apply(this,h)}return!0}else b&&(b=b.slice());if(b&&b.length){if(_>3)for(h=new Array(_-1),w=1;w<_;w++)h[w-1]=arguments[w];for(y=0,d=b.length;y<d;y++)switch(this.event=e,_){case 1:b[y].call(this);break;case 2:b[y].call(this,arguments[1]);break;case 3:b[y].call(this,arguments[1],arguments[2]);break;default:b[y].apply(this,h)}return!0}else if(!this.ignoreErrors&&!this._all&&e==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},E.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||l.call(this);var e=arguments[0],i=this.wildcard,c,h,d,y,w,T;if(e==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(i&&(c=e,e!=="newListener"&&e!=="removeListener"&&typeof e=="object")){if(y=e.length,g){for(w=0;w<y;w++)if(typeof e[w]=="symbol"){h=!0;break}}h||(e=e.join(this.delimiter))}var _=[],b=arguments.length,C;if(this._all)for(w=0,y=this._all.length;w<y;w++)switch(this.event=e,b){case 1:_.push(this._all[w].call(this,e));break;case 2:_.push(this._all[w].call(this,e,arguments[1]));break;case 3:_.push(this._all[w].call(this,e,arguments[1],arguments[2]));break;default:_.push(this._all[w].apply(this,arguments))}if(i?(C=[],z.call(this,C,c,this.listenerTree,0)):C=this._events[e],typeof C=="function")switch(this.event=e,b){case 1:_.push(C.call(this));break;case 2:_.push(C.call(this,arguments[1]));break;case 3:_.push(C.call(this,arguments[1],arguments[2]));break;default:for(d=new Array(b-1),T=1;T<b;T++)d[T-1]=arguments[T];_.push(C.apply(this,d))}else if(C&&C.length){if(C=C.slice(),b>3)for(d=new Array(b-1),T=1;T<b;T++)d[T-1]=arguments[T];for(w=0,y=C.length;w<y;w++)switch(this.event=e,b){case 1:_.push(C[w].call(this));break;case 2:_.push(C[w].call(this,arguments[1]));break;case 3:_.push(C[w].call(this,arguments[1],arguments[2]));break;default:_.push(C[w].apply(this,d))}}else if(!this.ignoreErrors&&!this._all&&e==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(_)},E.prototype.on=function(e,i,c){return this._on(e,i,!1,c)},E.prototype.prependListener=function(e,i,c){return this._on(e,i,!0,c)},E.prototype.onAny=function(e){return this._onAny(e,!1)},E.prototype.prependAny=function(e){return this._onAny(e,!0)},E.prototype.addListener=E.prototype.on,E.prototype._onAny=function(e,i){if(typeof e!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),i?this._all.unshift(e):this._all.push(e),this},E.prototype._on=function(e,i,c,h){if(typeof e=="function")return this._onAny(e,i),this;if(typeof i!="function")throw new Error("on only accepts instances of Function");this._events||l.call(this);var d=this,y;return h!==n&&(y=N.call(this,e,i,h),i=y[0],d=y[1]),this._newListener&&this.emit("newListener",e,i),this.wildcard?(X.call(this,e,i,c),d):(this._events[e]?(typeof this._events[e]=="function"&&(this._events[e]=[this._events[e]]),c?this._events[e].unshift(i):this._events[e].push(i),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,x.call(this,this._events[e].length,e))):this._events[e]=i,d)},E.prototype.off=function(e,i){if(typeof i!="function")throw new Error("removeListener only takes instances of Function");var c,h=[];if(this.wildcard){var d=typeof e=="string"?e.split(this.delimiter):e.slice();if(h=z.call(this,null,d,this.listenerTree,0),!h)return this}else{if(!this._events[e])return this;c=this._events[e],h.push({_listeners:c})}for(var y=0;y<h.length;y++){var w=h[y];if(c=w._listeners,o(c)){for(var T=-1,_=0,b=c.length;_<b;_++)if(c[_]===i||c[_].listener&&c[_].listener===i||c[_]._origin&&c[_]._origin===i){T=_;break}if(T<0)continue;return this.wildcard?w._listeners.splice(T,1):this._events[e].splice(T,1),c.length===0&&(this.wildcard?delete w._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,i),this}else(c===i||c.listener&&c.listener===i||c._origin&&c._origin===i)&&(this.wildcard?delete w._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,i))}return this.listenerTree&&F(this.listenerTree),this},E.prototype.offAny=function(e){var i=0,c=0,h;if(e&&this._all&&this._all.length>0){for(h=this._all,i=0,c=h.length;i<c;i++)if(e===h[i])return h.splice(i,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(h=this._all,this._removeListener)for(i=0,c=h.length;i<c;i++)this.emit("removeListenerAny",h[i]);this._all=[]}return this},E.prototype.removeListener=E.prototype.off,E.prototype.removeAllListeners=function(e){if(e===n)return!this._events||l.call(this),this;if(this.wildcard){var i=z.call(this,null,e,this.listenerTree,0),c,h;if(!i)return this;for(h=0;h<i.length;h++)c=i[h],c._listeners=null;this.listenerTree&&F(this.listenerTree)}else this._events&&(this._events[e]=null);return this},E.prototype.listeners=function(e){var i=this._events,c,h,d,y,w;if(e===n){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!i)return[];for(c=a(i),y=c.length,d=[];y-- >0;)h=i[c[y]],typeof h=="function"?d.push(h):d.push.apply(d,h);return d}else{if(this.wildcard){if(w=this.listenerTree,!w)return[];var T=[],_=typeof e=="string"?e.split(this.delimiter):e.slice();return z.call(this,T,_,w,0),T}return i?(h=i[e],h?typeof h=="function"?[h]:h:[]):[]}},E.prototype.eventNames=function(e){var i=this._events;return this.wildcard?R.call(this,this.listenerTree,[],null,e):i?a(i):[]},E.prototype.listenerCount=function(e){return this.listeners(e).length},E.prototype.hasListeners=function(e){if(this.wildcard){var i=[],c=typeof e=="string"?e.split(this.delimiter):e.slice();return z.call(this,i,c,this.listenerTree,0),i.length>0}var h=this._events,d=this._all;return!!(d&&d.length||h&&(e===n?a(h).length:h[e]))},E.prototype.listenersAny=function(){return this._all?this._all:[]},E.prototype.waitFor=function(e,i){var c=this,h=typeof i;return h==="number"?i={timeout:i}:h==="function"&&(i={filter:i}),i=L(i,{timeout:0,filter:n,handleError:!1,Promise,overload:!1},{filter:q,Promise:M}),J(i.Promise,function(d,y,w){function T(){var _=i.filter;if(!(_&&!_.apply(c,arguments)))if(c.off(e,T),i.handleError){var b=arguments[0];b?y(b):d(k.apply(null,arguments).slice(1))}else d(k.apply(null,arguments))}w(function(){c.off(e,T)}),c._on(e,T,!1)},{timeout:i.timeout,overload:i.overload})};function P(e,i,c){c=L(c,{Promise,timeout:0,overload:!1},{Promise:M});var h=c.Promise;return J(h,function(d,y,w){var T;if(typeof e.addEventListener=="function"){T=function(){d(k.apply(null,arguments))},w(function(){e.removeEventListener(i,T)}),e.addEventListener(i,T,{once:!0});return}var _=function(){b&&e.removeListener("error",b),d(k.apply(null,arguments))},b;i!=="error"&&(b=function(C){e.removeListener(i,_),y(C)},e.once("error",b)),w(function(){b&&e.removeListener("error",b),e.removeListener(i,_)}),e.once(i,_)},{timeout:c.timeout,overload:c.overload})}var I=E.prototype;Object.defineProperties(E,{defaultMaxListeners:{get:function(){return I._maxListeners},set:function(e){if(typeof e!="number"||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");I._maxListeners=e},enumerable:!0},once:{value:P,writable:!0,configurable:!0}}),Object.defineProperties(I,{_maxListeners:{value:u,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),m.exports=E})()}(Me)),Me.exports}var Ue,At;function he(){if(At)return Ue;At=1;var m=or();ne();var t=$().EventEmitter2;function n(r){r=r||{},this.ros=r.ros,this.name=r.name,this.serviceType=r.serviceType,this.isAdvertised=!1,this._serviceCallback=null}return n.prototype.__proto__=t.prototype,n.prototype.callService=function(r,o,u){if(!this.isAdvertised){var S="call_service:"+this.name+":"+ ++this.ros.idCounter;(o||u)&&this.ros.once(S,function(p){p.result!==void 0&&p.result===!1?typeof u=="function"&&u(p.values):typeof o=="function"&&o(new m(p.values))});var g={op:"call_service",id:S,service:this.name,type:this.serviceType,args:r};this.ros.callOnConnection(g)}},n.prototype.advertise=function(r){this.isAdvertised||typeof r!="function"||(this._serviceCallback=r,this.ros.on(this.name,this._serviceResponse.bind(this)),this.ros.callOnConnection({op:"advertise_service",type:this.serviceType,service:this.name}),this.isAdvertised=!0)},n.prototype.unadvertise=function(){this.isAdvertised&&(this.ros.callOnConnection({op:"unadvertise_service",service:this.name}),this.isAdvertised=!1)},n.prototype._serviceResponse=function(r){var o={},u=this._serviceCallback(r.args,o),S={op:"service_response",service:this.name,values:new m(o),result:u};r.id&&(S.id=r.id),this.ros.callOnConnection(S)},Ue=n,Ue}var ke,Rt;function ct(){if(Rt)return ke;Rt=1;var m=nr(),t=_r(),n=Ar(),r=he(),o=ne(),u=ee(),S=$().EventEmitter2;function g(p){p=p||{};var v=this;this.socket=null,this.idCounter=0,this.isConnected=!1,this.transportLibrary=p.transportLibrary||"websocket",this.transportOptions=p.transportOptions||{},this._sendFunc=function(s){v.sendEncodedMessage(s)},typeof p.groovyCompatibility>"u"?this.groovyCompatibility=!0:this.groovyCompatibility=p.groovyCompatibility,this.setMaxListeners(0),p.url&&this.connect(p.url)}return g.prototype.__proto__=S.prototype,g.prototype.connect=function(p){if(this.transportLibrary==="socket.io")this.socket=u(io(p,{"force new connection":!0}),n(this)),this.socket.on("connect",this.socket.onopen),this.socket.on("data",this.socket.onmessage),this.socket.on("close",this.socket.onclose),this.socket.on("error",this.socket.onerror);else if(this.transportLibrary.constructor.name==="RTCPeerConnection")this.socket=u(this.transportLibrary.createDataChannel(p,this.transportOptions),n(this));else if(this.transportLibrary==="websocket"){if(!this.socket||this.socket.readyState===m.CLOSED){var v=new m(p);v.binaryType="arraybuffer",this.socket=u(v,n(this))}}else if(this.transportLibrary==="workersocket")this.socket=u(new t(p),n(this));else throw"Unknown transportLibrary: "+this.transportLibrary.toString()},g.prototype.close=function(){this.socket&&this.socket.close()},g.prototype.authenticate=function(p,v,s,a,l,f,x){var k={op:"auth",mac:p,client:v,dest:s,rand:a,t:l,level:f,end:x};this.callOnConnection(k)},g.prototype.sendEncodedMessage=function(p){var v=null,s=this;this.transportLibrary==="socket.io"?v=function(a){s.socket.emit("operation",a)}:v=function(a){s.socket.send(a)},this.isConnected?v(p):s.once("connection",function(){v(p)})},g.prototype.callOnConnection=function(p){this.transportOptions.encoder?this.transportOptions.encoder(p,this._sendFunc):this._sendFunc(JSON.stringify(p))},g.prototype.setStatusLevel=function(p,v){var s={op:"set_level",level:p,id:v};this.callOnConnection(s)},g.prototype.getActionServers=function(p,v){var s=new r({ros:this,name:"/rosapi/action_servers",serviceType:"rosapi/GetActionServers"}),a=new o({});typeof v=="function"?s.callService(a,function(l){p(l.action_servers)},function(l){v(l)}):s.callService(a,function(l){p(l.action_servers)})},g.prototype.getTopics=function(p,v){var s=new r({ros:this,name:"/rosapi/topics",serviceType:"rosapi/Topics"}),a=new o;typeof v=="function"?s.callService(a,function(l){p(l)},function(l){v(l)}):s.callService(a,function(l){p(l)})},g.prototype.getTopicsForType=function(p,v,s){var a=new r({ros:this,name:"/rosapi/topics_for_type",serviceType:"rosapi/TopicsForType"}),l=new o({type:p});typeof s=="function"?a.callService(l,function(f){v(f.topics)},function(f){s(f)}):a.callService(l,function(f){v(f.topics)})},g.prototype.getServices=function(p,v){var s=new r({ros:this,name:"/rosapi/services",serviceType:"rosapi/Services"}),a=new o;typeof v=="function"?s.callService(a,function(l){p(l.services)},function(l){v(l)}):s.callService(a,function(l){p(l.services)})},g.prototype.getServicesForType=function(p,v,s){var a=new r({ros:this,name:"/rosapi/services_for_type",serviceType:"rosapi/ServicesForType"}),l=new o({type:p});typeof s=="function"?a.callService(l,function(f){v(f.services)},function(f){s(f)}):a.callService(l,function(f){v(f.services)})},g.prototype.getServiceRequestDetails=function(p,v,s){var a=new r({ros:this,name:"/rosapi/service_request_details",serviceType:"rosapi/ServiceRequestDetails"}),l=new o({type:p});typeof s=="function"?a.callService(l,function(f){v(f)},function(f){s(f)}):a.callService(l,function(f){v(f)})},g.prototype.getServiceResponseDetails=function(p,v,s){var a=new r({ros:this,name:"/rosapi/service_response_details",serviceType:"rosapi/ServiceResponseDetails"}),l=new o({type:p});typeof s=="function"?a.callService(l,function(f){v(f)},function(f){s(f)}):a.callService(l,function(f){v(f)})},g.prototype.getNodes=function(p,v){var s=new r({ros:this,name:"/rosapi/nodes",serviceType:"rosapi/Nodes"}),a=new o;typeof v=="function"?s.callService(a,function(l){p(l.nodes)},function(l){v(l)}):s.callService(a,function(l){p(l.nodes)})},g.prototype.getNodeDetails=function(p,v,s){var a=new r({ros:this,name:"/rosapi/node_details",serviceType:"rosapi/NodeDetails"}),l=new o({node:p});typeof s=="function"?a.callService(l,function(f){v(f.subscribing,f.publishing,f.services)},function(f){s(f)}):a.callService(l,function(f){v(f)})},g.prototype.getParams=function(p,v){var s=new r({ros:this,name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"}),a=new o;typeof v=="function"?s.callService(a,function(l){p(l.names)},function(l){v(l)}):s.callService(a,function(l){p(l.names)})},g.prototype.getTopicType=function(p,v,s){var a=new r({ros:this,name:"/rosapi/topic_type",serviceType:"rosapi/TopicType"}),l=new o({topic:p});typeof s=="function"?a.callService(l,function(f){v(f.type)},function(f){s(f)}):a.callService(l,function(f){v(f.type)})},g.prototype.getServiceType=function(p,v,s){var a=new r({ros:this,name:"/rosapi/service_type",serviceType:"rosapi/ServiceType"}),l=new o({service:p});typeof s=="function"?a.callService(l,function(f){v(f.type)},function(f){s(f)}):a.callService(l,function(f){v(f.type)})},g.prototype.getMessageDetails=function(p,v,s){var a=new r({ros:this,name:"/rosapi/message_details",serviceType:"rosapi/MessageDetails"}),l=new o({type:p});typeof s=="function"?a.callService(l,function(f){v(f.typedefs)},function(f){s(f)}):a.callService(l,function(f){v(f.typedefs)})},g.prototype.decodeTypeDefs=function(p){var v=this,s=function(a,l){for(var f={},x=0;x<a.fieldnames.length;x++){var k=a.fieldarraylen[x],O=a.fieldnames[x],A=a.fieldtypes[x];if(A.indexOf("/")===-1)k===-1?f[O]=A:f[O]=[A];else{for(var L=!1,M=0;M<l.length;M++)if(l[M].type.toString()===A.toString()){L=l[M];break}if(L){var D=s(L,l);k===-1?f[O]=D:f[O]=[D]}else v.emit("error","Cannot find "+A+" in decodeTypeDefs")}}return f};return s(p[0],p)},g.prototype.getTopicsAndRawTypes=function(p,v){var s=new r({ros:this,name:"/rosapi/topics_and_raw_types",serviceType:"rosapi/TopicsAndRawTypes"}),a=new o;typeof v=="function"?s.callService(a,function(l){p(l)},function(l){v(l)}):s.callService(a,function(l){p(l)})},ke=g,ke}var Ce,Lt;function re(){if(Lt)return Ce;Lt=1;var m=ee();function t(n){m(this,n)}return Ce=t,Ce}var Ne,Ot;function oe(){if(Ot)return Ne;Ot=1;var m=$().EventEmitter2,t=re();function n(r){r=r||{},this.ros=r.ros,this.name=r.name,this.messageType=r.messageType,this.isAdvertised=!1,this.compression=r.compression||"none",this.throttle_rate=r.throttle_rate||0,this.latch=r.latch||!1,this.queue_size=r.queue_size||100,this.queue_length=r.queue_length||0,this.reconnect_on_close=r.reconnect_on_close!==void 0?r.reconnect_on_close:!0,this.compression&&this.compression!=="png"&&this.compression!=="cbor"&&this.compression!=="cbor-raw"&&this.compression!=="none"&&(this.emit("warning",this.compression+" compression is not supported. No compression will be used."),this.compression="none"),this.throttle_rate<0&&(this.emit("warning",this.throttle_rate+" is not allowed. Set to 0"),this.throttle_rate=0);var o=this;this.reconnect_on_close?this.callForSubscribeAndAdvertise=function(u){o.ros.callOnConnection(u),o.waitForReconnect=!1,o.reconnectFunc=function(){o.waitForReconnect||(o.waitForReconnect=!0,o.ros.callOnConnection(u),o.ros.once("connection",function(){o.waitForReconnect=!1}))},o.ros.on("close",o.reconnectFunc)}:this.callForSubscribeAndAdvertise=this.ros.callOnConnection,this._messageCallback=function(u){o.emit("message",new t(u))}}return n.prototype.__proto__=m.prototype,n.prototype.subscribe=function(r){typeof r=="function"&&this.on("message",r),!this.subscribeId&&(this.ros.on(this.name,this._messageCallback),this.subscribeId="subscribe:"+this.name+":"+ ++this.ros.idCounter,this.callForSubscribeAndAdvertise({op:"subscribe",id:this.subscribeId,type:this.messageType,topic:this.name,compression:this.compression,throttle_rate:this.throttle_rate,queue_length:this.queue_length}))},n.prototype.unsubscribe=function(r){r&&(this.off("message",r),this.listeners("message").length)||this.subscribeId&&(this.ros.off(this.name,this._messageCallback),this.reconnect_on_close&&this.ros.off("close",this.reconnectFunc),this.emit("unsubscribe"),this.ros.callOnConnection({op:"unsubscribe",id:this.subscribeId,topic:this.name}),this.subscribeId=null)},n.prototype.advertise=function(){if(!this.isAdvertised&&(this.advertiseId="advertise:"+this.name+":"+ ++this.ros.idCounter,this.callForSubscribeAndAdvertise({op:"advertise",id:this.advertiseId,type:this.messageType,topic:this.name,latch:this.latch,queue_size:this.queue_size}),this.isAdvertised=!0,!this.reconnect_on_close)){var r=this;this.ros.on("close",function(){r.isAdvertised=!1})}},n.prototype.unadvertise=function(){this.isAdvertised&&(this.reconnect_on_close&&this.ros.off("close",this.reconnectFunc),this.emit("unadvertise"),this.ros.callOnConnection({op:"unadvertise",id:this.advertiseId,topic:this.name}),this.isAdvertised=!1)},n.prototype.publish=function(r){this.isAdvertised||this.advertise(),this.ros.idCounter++;var o={op:"publish",id:"publish:"+this.name+":"+this.ros.idCounter,topic:this.name,msg:r,latch:this.latch};this.ros.callOnConnection(o)},Ne=n,Ne}var Fe,Mt;function Rr(){if(Mt)return Fe;Mt=1;var m=he(),t=ne();function n(r){r=r||{},this.ros=r.ros,this.name=r.name}return n.prototype.get=function(r,o){var u=new m({ros:this.ros,name:"/rosapi/get_param",serviceType:"rosapi/GetParam"}),S=new t({name:this.name});u.callService(S,function(g){var p=JSON.parse(g.value);r(p)},o)},n.prototype.set=function(r,o,u){var S=new m({ros:this.ros,name:"/rosapi/set_param",serviceType:"rosapi/SetParam"}),g=new t({name:this.name,value:JSON.stringify(r)});S.callService(g,o,u)},n.prototype.delete=function(r,o){var u=new m({ros:this.ros,name:"/rosapi/delete_param",serviceType:"rosapi/DeleteParam"}),S=new t({name:this.name});u.callService(S,r,o)},Fe=n,Fe}var Ut;function Lr(){if(Ut)return ge.exports;Ut=1;var m=at(),t=ge.exports={Ros:ct(),Topic:oe(),Message:re(),Param:Rr(),Service:he(),ServiceRequest:ne(),ServiceResponse:or()};return m(t.Ros,["Param","Service","Topic"],t),ge.exports}var De={exports:{}},Pe,kt;function ar(){if(kt)return Pe;kt=1;var m=oe(),t=re(),n=$().EventEmitter2;function r(o){var u=this;o=o||{},this.ros=o.ros,this.serverName=o.serverName,this.actionName=o.actionName,this.timeout=o.timeout,this.omitFeedback=o.omitFeedback,this.omitStatus=o.omitStatus,this.omitResult=o.omitResult,this.goals={};var S=!1;this.feedbackListener=new m({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),this.statusListener=new m({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"}),this.resultListener=new m({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"}),this.goalTopic=new m({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),this.cancelTopic=new m({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"}),this.goalTopic.advertise(),this.cancelTopic.advertise(),this.omitStatus||this.statusListener.subscribe(function(g){S=!0,g.status_list.forEach(function(p){var v=u.goals[p.goal_id.id];v&&v.emit("status",p)})}),this.omitFeedback||this.feedbackListener.subscribe(function(g){var p=u.goals[g.status.goal_id.id];p&&(p.emit("status",g.status),p.emit("feedback",g.feedback))}),this.omitResult||this.resultListener.subscribe(function(g){var p=u.goals[g.status.goal_id.id];p&&(p.emit("status",g.status),p.emit("result",g.result))}),this.timeout&&setTimeout(function(){S||u.emit("timeout")},this.timeout)}return r.prototype.__proto__=n.prototype,r.prototype.cancel=function(){var o=new t;this.cancelTopic.publish(o)},r.prototype.dispose=function(){this.goalTopic.unadvertise(),this.cancelTopic.unadvertise(),this.omitStatus||this.statusListener.unsubscribe(),this.omitFeedback||this.feedbackListener.unsubscribe(),this.omitResult||this.resultListener.unsubscribe()},Pe=r,Pe}var Ie,Ct;function Or(){if(Ct)return Ie;Ct=1;var m=oe();re();var t=$().EventEmitter2;function n(r){var o=this;r=r||{},this.ros=r.ros,this.serverName=r.serverName,this.actionName=r.actionName;var u=new m({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),S=new m({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),g=new m({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"}),p=new m({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"});u.subscribe(function(v){o.emit("goal",v)}),g.subscribe(function(v){v.status_list.forEach(function(s){o.emit("status",s)})}),S.subscribe(function(v){o.emit("status",v.status),o.emit("feedback",v.feedback)}),p.subscribe(function(v){o.emit("status",v.status),o.emit("result",v.result)})}return n.prototype.__proto__=t.prototype,Ie=n,Ie}var qe,Nt;function cr(){if(Nt)return qe;Nt=1;var m=re(),t=$().EventEmitter2;function n(r){var o=this;this.actionClient=r.actionClient,this.goalMessage=r.goalMessage,this.isFinished=!1;var u=new Date;this.goalID="goal_"+Math.random()+"_"+u.getTime(),this.goalMessage=new m({goal_id:{stamp:{secs:0,nsecs:0},id:this.goalID},goal:this.goalMessage}),this.on("status",function(S){o.status=S}),this.on("result",function(S){o.isFinished=!0,o.result=S}),this.on("feedback",function(S){o.feedback=S}),this.actionClient.goals[this.goalID]=this}return n.prototype.__proto__=t.prototype,n.prototype.send=function(r){var o=this;o.actionClient.goalTopic.publish(o.goalMessage),r&&setTimeout(function(){o.isFinished||o.emit("timeout")},r)},n.prototype.cancel=function(){var r=new m({id:this.goalID});this.actionClient.cancelTopic.publish(r)},qe=n,qe}var Be,Ft;function Mr(){if(Ft)return Be;Ft=1;var m=oe(),t=re(),n=$().EventEmitter2;function r(o){var u=this;o=o||{},this.ros=o.ros,this.serverName=o.serverName,this.actionName=o.actionName,this.feedbackPublisher=new m({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),this.feedbackPublisher.advertise();var S=new m({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"});S.advertise(),this.resultPublisher=new m({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"}),this.resultPublisher.advertise();var g=new m({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),p=new m({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"});this.statusMessage=new t({header:{stamp:{secs:0,nsecs:100},frame_id:""},status_list:[]}),this.currentGoal=null,this.nextGoal=null,g.subscribe(function(s){u.currentGoal?(u.nextGoal=s,u.emit("cancel")):(u.statusMessage.status_list=[{goal_id:s.goal_id,status:1}],u.currentGoal=s,u.emit("goal",s.goal))});var v=function(s,a){return s.secs>a.secs?!1:s.secs<a.secs?!0:s.nsecs<a.nsecs};p.subscribe(function(s){s.stamp.secs===0&&s.stamp.secs===0&&s.id===""?(u.nextGoal=null,u.currentGoal&&u.emit("cancel")):(u.currentGoal&&s.id===u.currentGoal.goal_id.id?u.emit("cancel"):u.nextGoal&&s.id===u.nextGoal.goal_id.id&&(u.nextGoal=null),u.nextGoal&&v(u.nextGoal.goal_id.stamp,s.stamp)&&(u.nextGoal=null),u.currentGoal&&v(u.currentGoal.goal_id.stamp,s.stamp)&&u.emit("cancel"))}),setInterval(function(){var s=new Date,a=Math.floor(s.getTime()/1e3),l=Math.round(1e9*(s.getTime()/1e3-a));u.statusMessage.header.stamp.secs=a,u.statusMessage.header.stamp.nsecs=l,S.publish(u.statusMessage)},500)}return r.prototype.__proto__=n.prototype,r.prototype.setSucceeded=function(o){var u=new t({status:{goal_id:this.currentGoal.goal_id,status:3},result:o});this.resultPublisher.publish(u),this.statusMessage.status_list=[],this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},r.prototype.setAborted=function(o){var u=new t({status:{goal_id:this.currentGoal.goal_id,status:4},result:o});this.resultPublisher.publish(u),this.statusMessage.status_list=[],this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},r.prototype.sendFeedback=function(o){var u=new t({status:{goal_id:this.currentGoal.goal_id,status:1},feedback:o});this.feedbackPublisher.publish(u)},r.prototype.setPreempted=function(){this.statusMessage.status_list=[];var o=new t({status:{goal_id:this.currentGoal.goal_id,status:2}});this.resultPublisher.publish(o),this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},Be=r,Be}var Dt;function Ur(){if(Dt)return De.exports;Dt=1;var m=ct(),t=at(),n=De.exports={ActionClient:ar(),ActionListener:Or(),Goal:cr(),SimpleActionServer:Mr()};return t(m,["ActionClient","SimpleActionServer"],n),De.exports}var Ge,Pt;function te(){if(Pt)return Ge;Pt=1;function m(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.z=t.z||0}return m.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},m.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},m.prototype.multiplyQuaternion=function(t){var n=t.w*this.x+t.y*this.z-t.z*this.y,r=t.w*this.y+t.z*this.x-t.x*this.z,o=t.w*this.z+t.x*this.y-t.y*this.x,u=-t.x*this.x-t.y*this.y-t.z*this.z;this.x=n*t.w+u*-t.x+r*-t.z-o*-t.y,this.y=r*t.w+u*-t.y+o*-t.x-n*-t.z,this.z=o*t.w+u*-t.z+n*-t.y-r*-t.x},m.prototype.clone=function(){return new m(this)},Ge=m,Ge}var je,It;function ae(){if(It)return je;It=1;function m(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.w=typeof t.w=="number"?t.w:1}return m.prototype.conjugate=function(){this.x*=-1,this.y*=-1,this.z*=-1},m.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},m.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t===0?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t)},m.prototype.invert=function(){this.conjugate(),this.normalize()},m.prototype.multiply=function(t){var n=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,r=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,o=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,u=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;this.x=n,this.y=r,this.z=o,this.w=u},m.prototype.clone=function(){return new m(this)},je=m,je}var ze,qt;function ut(){if(qt)return ze;qt=1;var m=te(),t=ae();function n(r){r=r||{},this.position=new m(r.position),this.orientation=new t(r.orientation)}return n.prototype.applyTransform=function(r){this.position.multiplyQuaternion(r.rotation),this.position.add(r.translation);var o=r.rotation.clone();o.multiply(this.orientation),this.orientation=o},n.prototype.clone=function(){return new n(this)},n.prototype.multiply=function(r){var o=r.clone();return o.applyTransform({rotation:this.orientation,translation:this.position}),o},n.prototype.getInverse=function(){var r=this.clone();return r.orientation.invert(),r.position.multiplyQuaternion(r.orientation),r.position.x*=-1,r.position.y*=-1,r.position.z*=-1,r},ze=n,ze}var Ve,Bt;function ur(){if(Bt)return Ve;Bt=1;var m=te(),t=ae();function n(r){r=r||{},this.translation=new m(r.translation),this.rotation=new t(r.rotation)}return n.prototype.clone=function(){return new n(this)},Ve=n,Ve}var We,Gt;function kr(){return Gt||(Gt=1,We={Pose:ut(),Quaternion:ae(),Transform:ur(),Vector3:te()}),We}var Ke={exports:{}},He,jt;function Cr(){if(jt)return He;jt=1;var m=ar(),t=cr(),n=he(),r=ne(),o=oe(),u=ur();function S(g){g=g||{},this.ros=g.ros,this.fixedFrame=g.fixedFrame||"base_link",this.angularThres=g.angularThres||2,this.transThres=g.transThres||.01,this.rate=g.rate||10,this.updateDelay=g.updateDelay||50;var p=g.topicTimeout||2,v=Math.floor(p),s=Math.floor((p-v)*1e9);this.topicTimeout={secs:v,nsecs:s},this.serverName=g.serverName||"/tf2_web_republisher",this.repubServiceName=g.repubServiceName||"/republish_tfs",this.currentGoal=!1,this.currentTopic=!1,this.frameInfos={},this.republisherUpdateRequested=!1,this._subscribeCB=null,this._isDisposed=!1,this.actionClient=new m({ros:g.ros,serverName:this.serverName,actionName:"tf2_web_republisher/TFSubscriptionAction",omitStatus:!0,omitResult:!0}),this.serviceClient=new n({ros:g.ros,name:this.repubServiceName,serviceType:"tf2_web_republisher/RepublishTFs"})}return S.prototype.processTFArray=function(g){g.transforms.forEach(function(p){var v=p.child_frame_id;v[0]==="/"&&(v=v.substring(1));var s=this.frameInfos[v];s&&(s.transform=new u({translation:p.transform.translation,rotation:p.transform.rotation}),s.cbs.forEach(function(a){a(s.transform)}))},this)},S.prototype.updateGoal=function(){var g={source_frames:Object.keys(this.frameInfos),target_frame:this.fixedFrame,angular_thres:this.angularThres,trans_thres:this.transThres,rate:this.rate};if(this.ros.groovyCompatibility)this.currentGoal&&this.currentGoal.cancel(),this.currentGoal=new t({actionClient:this.actionClient,goalMessage:g}),this.currentGoal.on("feedback",this.processTFArray.bind(this)),this.currentGoal.send();else{g.timeout=this.topicTimeout;var p=new r(g);this.serviceClient.callService(p,this.processResponse.bind(this))}this.republisherUpdateRequested=!1},S.prototype.processResponse=function(g){this._isDisposed||(this.currentTopic&&this.currentTopic.unsubscribe(this._subscribeCB),this.currentTopic=new o({ros:this.ros,name:g.topic_name,messageType:"tf2_web_republisher/TFArray"}),this._subscribeCB=this.processTFArray.bind(this),this.currentTopic.subscribe(this._subscribeCB))},S.prototype.subscribe=function(g,p){g[0]==="/"&&(g=g.substring(1)),this.frameInfos[g]?this.frameInfos[g].transform&&p(this.frameInfos[g].transform):(this.frameInfos[g]={cbs:[]},this.republisherUpdateRequested||(setTimeout(this.updateGoal.bind(this),this.updateDelay),this.republisherUpdateRequested=!0)),this.frameInfos[g].cbs.push(p)},S.prototype.unsubscribe=function(g,p){g[0]==="/"&&(g=g.substring(1));for(var v=this.frameInfos[g],s=v&&v.cbs||[],a=s.length;a--;)s[a]===p&&s.splice(a,1);(!p||s.length===0)&&delete this.frameInfos[g]},S.prototype.dispose=function(){this._isDisposed=!0,this.actionClient.dispose(),this.currentTopic&&this.currentTopic.unsubscribe(this._subscribeCB)},He=S,He}var zt;function Nr(){if(zt)return Ke.exports;zt=1;var m=ct(),t=at(),n=Ke.exports={TFClient:Cr()};return t(m,["TFClient"],n),Ke.exports}var Je,Vt;function ce(){return Vt||(Vt=1,Je={URDF_SPHERE:0,URDF_BOX:1,URDF_CYLINDER:2,URDF_MESH:3}),Je}var Ye,Wt;function lr(){if(Wt)return Ye;Wt=1;var m=te(),t=ce();function n(r){this.dimension=null,this.type=t.URDF_BOX;var o=r.xml.getAttribute("size").split(" ");this.dimension=new m({x:parseFloat(o[0]),y:parseFloat(o[1]),z:parseFloat(o[2])})}return Ye=n,Ye}var Qe,Kt;function fr(){if(Kt)return Qe;Kt=1;function m(t){var n=t.xml.getAttribute("rgba").split(" ");this.r=parseFloat(n[0]),this.g=parseFloat(n[1]),this.b=parseFloat(n[2]),this.a=parseFloat(n[3])}return Qe=m,Qe}var Xe,Ht;function hr(){if(Ht)return Xe;Ht=1;var m=ce();function t(n){this.type=m.URDF_CYLINDER,this.length=parseFloat(n.xml.getAttribute("length")),this.radius=parseFloat(n.xml.getAttribute("radius"))}return Xe=t,Xe}var Ze,Jt;function lt(){if(Jt)return Ze;Jt=1;var m=fr();function t(r){this.textureFilename=null,this.color=null,this.name=r.xml.getAttribute("name");var o=r.xml.getElementsByTagName("texture");o.length>0&&(this.textureFilename=o[0].getAttribute("filename"));var u=r.xml.getElementsByTagName("color");u.length>0&&(this.color=new m({xml:u[0]}))}t.prototype.isLink=function(){return this.color===null&&this.textureFilename===null};var n=ee();return t.prototype.assign=function(r){return n(this,r)},Ze=t,Ze}var $e,Yt;function vr(){if(Yt)return $e;Yt=1;var m=te(),t=ce();function n(r){this.scale=null,this.type=t.URDF_MESH,this.filename=r.xml.getAttribute("filename");var o=r.xml.getAttribute("scale");if(o){var u=o.split(" ");this.scale=new m({x:parseFloat(u[0]),y:parseFloat(u[1]),z:parseFloat(u[2])})}}return $e=n,$e}var et,Qt;function pr(){if(Qt)return et;Qt=1;var m=ce();function t(n){this.type=m.URDF_SPHERE,this.radius=parseFloat(n.xml.getAttribute("radius"))}return et=t,et}var tt,Xt;function dr(){if(Xt)return tt;Xt=1;var m=ut(),t=te(),n=ae(),r=hr(),o=lr(),u=lt(),S=vr(),g=pr();function p(v){var s=v.xml;this.origin=null,this.geometry=null,this.material=null,this.name=v.xml.getAttribute("name");var a=s.getElementsByTagName("origin");if(a.length===0)this.origin=new m;else{var l=a[0].getAttribute("xyz"),f=new t;l&&(l=l.split(" "),f=new t({x:parseFloat(l[0]),y:parseFloat(l[1]),z:parseFloat(l[2])}));var x=a[0].getAttribute("rpy"),k=new n;if(x){x=x.split(" ");var O=parseFloat(x[0]),A=parseFloat(x[1]),L=parseFloat(x[2]),M=O/2,D=A/2,q=L/2,V=Math.sin(M)*Math.cos(D)*Math.cos(q)-Math.cos(M)*Math.sin(D)*Math.sin(q),J=Math.cos(M)*Math.sin(D)*Math.cos(q)+Math.sin(M)*Math.cos(D)*Math.sin(q),Q=Math.cos(M)*Math.cos(D)*Math.sin(q)-Math.sin(M)*Math.sin(D)*Math.cos(q),z=Math.cos(M)*Math.cos(D)*Math.cos(q)+Math.sin(M)*Math.sin(D)*Math.sin(q);k=new n({x:V,y:J,z:Q,w:z}),k.normalize()}this.origin=new m({position:f,orientation:k})}var X=s.getElementsByTagName("geometry");if(X.length>0){for(var R=X[0],F=null,U=0;U<R.childNodes.length;U++){var N=R.childNodes[U];if(N.nodeType===1){F=N;break}}var E=F.nodeName;E==="sphere"?this.geometry=new g({xml:F}):E==="box"?this.geometry=new o({xml:F}):E==="cylinder"?this.geometry=new r({xml:F}):E==="mesh"?this.geometry=new S({xml:F}):console.warn("Unknown geometry type "+E)}var P=s.getElementsByTagName("material");P.length>0&&(this.material=new u({xml:P[0]}))}return tt=p,tt}var rt,Zt;function mr(){if(Zt)return rt;Zt=1;var m=dr();function t(n){this.name=n.xml.getAttribute("name"),this.visuals=[];for(var r=n.xml.getElementsByTagName("visual"),o=0;o<r.length;o++)this.visuals.push(new m({xml:r[o]}))}return rt=t,rt}var it,$t;function Fr(){if($t)return it;$t=1;var m=ut(),t=te(),n=ae();function r(o){this.name=o.xml.getAttribute("name"),this.type=o.xml.getAttribute("type");var u=o.xml.getElementsByTagName("parent");u.length>0&&(this.parent=u[0].getAttribute("link"));var S=o.xml.getElementsByTagName("child");S.length>0&&(this.child=S[0].getAttribute("link"));var g=o.xml.getElementsByTagName("limit");g.length>0&&(this.minval=parseFloat(g[0].getAttribute("lower")),this.maxval=parseFloat(g[0].getAttribute("upper")));var p=o.xml.getElementsByTagName("origin");if(p.length===0)this.origin=new m;else{var v=p[0].getAttribute("xyz"),s=new t;v&&(v=v.split(" "),s=new t({x:parseFloat(v[0]),y:parseFloat(v[1]),z:parseFloat(v[2])}));var a=p[0].getAttribute("rpy"),l=new n;if(a){a=a.split(" ");var f=parseFloat(a[0]),x=parseFloat(a[1]),k=parseFloat(a[2]),O=f/2,A=x/2,L=k/2,M=Math.sin(O)*Math.cos(A)*Math.cos(L)-Math.cos(O)*Math.sin(A)*Math.sin(L),D=Math.cos(O)*Math.sin(A)*Math.cos(L)+Math.sin(O)*Math.cos(A)*Math.sin(L),q=Math.cos(O)*Math.cos(A)*Math.sin(L)-Math.sin(O)*Math.sin(A)*Math.cos(L),V=Math.cos(O)*Math.cos(A)*Math.cos(L)+Math.sin(O)*Math.sin(A)*Math.sin(L);l=new n({x:M,y:D,z:q,w:V}),l.normalize()}this.origin=new m({position:s,orientation:l})}}return it=r,it}var se={},er;function Dr(){return er||(er=1,se.DOMImplementation=window.DOMImplementation,se.XMLSerializer=window.XMLSerializer,se.DOMParser=window.DOMParser),se}var st,tr;function Pr(){if(tr)return st;tr=1;var m=lt(),t=mr(),n=Fr(),r=Dr().DOMParser;function o(u){u=u||{};var S=u.xml,g=u.string;if(this.materials={},this.links={},this.joints={},g){var p=new r;S=p.parseFromString(g,"text/xml")}var v=S.documentElement;this.name=v.getAttribute("name");for(var s=v.childNodes,a=0;a<s.length;a++){var l=s[a];if(l.tagName==="material"){var f=new m({xml:l});this.materials[f.name]!==void 0?this.materials[f.name].isLink()?this.materials[f.name].assign(f):console.warn("Material "+f.name+"is not unique."):this.materials[f.name]=f}else if(l.tagName==="link"){var x=new t({xml:l});if(this.links[x.name]!==void 0)console.warn("Link "+x.name+" is not unique.");else{for(var k=0;k<x.visuals.length;k++){var O=x.visuals[k].material;O!==null&&O.name&&(this.materials[O.name]!==void 0?x.visuals[k].material=this.materials[O.name]:this.materials[O.name]=O)}this.links[x.name]=x}}else if(l.tagName==="joint"){var A=new n({xml:l});this.joints[A.name]=A}}}return st=o,st}var nt,rr;function Ir(){return rr||(rr=1,nt=ee()({UrdfBox:lr(),UrdfColor:fr(),UrdfCylinder:hr(),UrdfLink:mr(),UrdfMaterial:lt(),UrdfMesh:vr(),UrdfModel:Pr(),UrdfSphere:pr(),UrdfVisual:dr()},ce())),nt}var ue,ir;function qr(){if(ir)return ue;ir=1;var m=ue.ROSLIB||{REVISION:"1.4.1"},t=ee();return t(m,Lr()),t(m,Ur()),t(m,kr()),t(m,Nr()),t(m,Ir()),ue=m,ue}var Br=qr();const ot=sr(Br);var Gr=$();const jr=sr(Gr),j={ROS:{WEBSOCKET_URL:"ws://localhost:9090",RECONNECT_INTERVAL:5e3,TOPIC_NAME:"/cmd_vel",MESSAGE_TYPE:"geometry_msgs/Twist"},CONTROLS:{DEFAULT_SPEED:.5,MAX_LINEAR_SPEED:.5,MAX_ANGULAR_SPEED:.5,SPEED_STEP:.1},UI:{BUTTON_SIZE:100,ANIMATION_DURATION:200,STATUS_UPDATE_INTERVAL:1e3},KEYBOARD:{FORWARD:["w","arrowup"],BACKWARD:["s","arrowdown"],LEFT:["a","arrowleft"],RIGHT:["d","arrowright"],STOP:[" "]},AUTH:{DEFAULT_PASSWORD:"robot2024",SESSION_DURATION:24*60*60*1e3,AUTH_CHECK_INTERVAL:3e4,LOGIN_PAGE:"./login.html",MAIN_PAGE:"./index.html"},DEV:{DEBUG_MODE:!0,LOG_LEVEL:"info",AUTO_RECONNECT:!0}};class zr{constructor(){this.isAuthenticated=!1,this.sessionKey="mcs_remote_control_session",this.checkSession()}checkSession(){const t=sessionStorage.getItem(this.sessionKey);if(t)try{const n=JSON.parse(t),r=Date.now();if(n.expires>r)return this.isAuthenticated=!0,!0;this.logout()}catch(n){console.error("Invalid session data:",n),this.logout()}return!1}login(t){const n=j.AUTH.DEFAULT_PASSWORD;if(t===n){this.isAuthenticated=!0;const r={authenticated:!0,timestamp:Date.now(),expires:Date.now()+j.AUTH.SESSION_DURATION};return sessionStorage.setItem(this.sessionKey,JSON.stringify(r)),!0}return!1}logout(){this.isAuthenticated=!1,sessionStorage.removeItem(this.sessionKey)}isLoggedIn(){return this.isAuthenticated}getSessionInfo(){const t=sessionStorage.getItem(this.sessionKey);if(t)try{return JSON.parse(t)}catch{return null}return null}changePassword(t){j.AUTH.DEFAULT_PASSWORD=t,console.warn("Password changed. In production, this should be handled server-side.")}}const le=new zr;class Vr{constructor(){this.ros=null,this.cmdVelTopic=null,this.isConnected=!1,this.speedMultiplier=j.CONTROLS.DEFAULT_SPEED,this.eventEmitter=new jr,this.checkAuthentication()&&this.init()}checkAuthentication(){return le.isLoggedIn()?!0:(window.location.href=j.AUTH.LOGIN_PAGE,!1)}init(){this.setupUI(),this.setupEventListeners(),this.connectToROS(),this.updateSessionInfo()}setupUI(){this.elements={statusIndicator:document.getElementById("statusIndicator"),statusText:document.getElementById("statusText"),speedSlider:document.getElementById("speedSlider"),speedValue:document.getElementById("speedValue"),controlButtons:document.querySelectorAll(".control-btn"),wsUrl:document.getElementById("wsUrl"),logoutBtn:document.getElementById("logoutBtn"),sessionStatus:document.getElementById("sessionStatus"),sessionExpires:document.getElementById("sessionExpires")},this.updateSpeedDisplay(),this.elements.wsUrl&&(this.elements.wsUrl.textContent=j.ROS.WEBSOCKET_URL)}setupEventListeners(){this.elements.speedSlider.addEventListener("input",t=>{this.speedMultiplier=t.target.value/100,this.updateSpeedDisplay()}),this.elements.controlButtons.forEach(t=>{t.addEventListener("click",n=>{const r=n.currentTarget.dataset.action;this.handleControlAction(r)}),t.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" "){n.preventDefault();const r=n.currentTarget.dataset.action;this.handleControlAction(r)}})}),this.elements.logoutBtn&&this.elements.logoutBtn.addEventListener("click",()=>{this.handleLogout()}),document.addEventListener("keydown",t=>{this.handleKeyboardInput(t)}),document.addEventListener("keyup",t=>{this.handleKeyboardRelease(t)}),setInterval(()=>{le.isLoggedIn()||this.handleLogout()},j.AUTH.AUTH_CHECK_INTERVAL)}handleLogout(){this.publishCmdVel(0,0),le.logout(),window.location.href=j.AUTH.LOGIN_PAGE}updateSessionInfo(){const t=le.getSessionInfo();if(t&&this.elements.sessionStatus&&this.elements.sessionExpires){this.elements.sessionStatus.textContent="Authenticated";const n=Date.now(),r=t.expires-n,o=Math.floor(r/(1e3*60*60)),u=Math.floor(r%(1e3*60*60)/(1e3*60));o>0?this.elements.sessionExpires.textContent=`${o}h ${u}m`:this.elements.sessionExpires.textContent=`${u}m`}}connectToROS(){try{this.ros=new ot.Ros({url:j.ROS.WEBSOCKET_URL}),this.ros.on("connection",()=>{j.DEV.DEBUG_MODE&&console.log("Connected to ROS2 WebSocket server"),this.isConnected=!0,this.updateConnectionStatus("connected","Connected"),this.setupROSTopics(),this.enableControls()}),this.ros.on("error",t=>{console.error("ROS2 connection error:",t),this.isConnected=!1,this.updateConnectionStatus("disconnected","Connection Error"),this.disableControls()}),this.ros.on("close",()=>{j.DEV.DEBUG_MODE&&console.log("ROS2 connection closed"),this.isConnected=!1,this.updateConnectionStatus("disconnected","Disconnected"),this.disableControls(),j.DEV.AUTO_RECONNECT&&setTimeout(()=>{this.isConnected||(j.DEV.DEBUG_MODE&&console.log("Attempting to reconnect..."),this.connectToROS())},j.ROS.RECONNECT_INTERVAL)})}catch(t){console.error("Failed to initialize ROS2 connection:",t),this.updateConnectionStatus("disconnected","Failed to Connect")}}setupROSTopics(){this.cmdVelTopic=new ot.Topic({ros:this.ros,name:j.ROS.TOPIC_NAME,messageType:j.ROS.MESSAGE_TYPE})}updateConnectionStatus(t,n){const r=this.elements.statusIndicator,o=this.elements.statusText;r.classList.remove("connected","disconnected"),r.classList.add(t),o.textContent=n}updateSpeedDisplay(){const t=Math.round(this.speedMultiplier*100);this.elements.speedValue.textContent=`${t}%`}enableControls(){this.elements.controlButtons.forEach(t=>{t.disabled=!1})}disableControls(){this.elements.controlButtons.forEach(t=>{t.disabled=!0})}handleControlAction(t){if(!this.isConnected||!this.cmdVelTopic){console.warn("Not connected to ROS2");return}let n=0,r=0;switch(t){case"forward":n=j.CONTROLS.MAX_LINEAR_SPEED*this.speedMultiplier;break;case"backward":n=-.5*this.speedMultiplier;break;case"left":r=j.CONTROLS.MAX_ANGULAR_SPEED*this.speedMultiplier;break;case"right":r=-.5*this.speedMultiplier;break;case"stop":n=0,r=0;break;default:console.warn("Unknown action:",t);return}this.publishCmdVel(n,r)}handleKeyboardInput(t){if(!this.isConnected)return;let n=null;const r=t.key.toLowerCase();j.KEYBOARD.FORWARD.includes(r)?n="forward":j.KEYBOARD.BACKWARD.includes(r)?n="backward":j.KEYBOARD.LEFT.includes(r)?n="left":j.KEYBOARD.RIGHT.includes(r)?n="right":j.KEYBOARD.STOP.includes(r)&&(n="stop"),n&&(t.preventDefault(),this.handleControlAction(n))}handleKeyboardRelease(t){if(!this.isConnected)return;[...j.KEYBOARD.FORWARD,...j.KEYBOARD.BACKWARD,...j.KEYBOARD.LEFT,...j.KEYBOARD.RIGHT].includes(t.key.toLowerCase())&&this.handleControlAction("stop")}publishCmdVel(t,n){if(!this.cmdVelTopic){console.error("cmd_vel topic not initialized");return}const r=new ot.Message({linear:{x:t,y:0,z:0},angular:{x:0,y:0,z:n}});try{this.cmdVelTopic.publish(r),j.DEV.DEBUG_MODE&&console.log(`Published cmd_vel: linear.x=${t.toFixed(2)}, angular.z=${n.toFixed(2)}`)}catch(o){console.error("Failed to publish cmd_vel:",o)}}getConnectionStatus(){return this.isConnected}getSpeedMultiplier(){return this.speedMultiplier}setSpeedMultiplier(t){this.speedMultiplier=Math.max(.1,Math.min(1,t)),this.updateSpeedDisplay()}}document.addEventListener("DOMContentLoaded",()=>{console.log("Initializing MCS Robot Controller..."),window.robotController=new Vr});
